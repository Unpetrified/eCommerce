{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static 'logo/logo.png' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {%block style %}{% endblock %}
    {%block title %}{% endblock %}
</head>
<body>
    <header>
        <a href="/"><img class="logo" src="{% static 'logo/IMG_2473.jpg' %}" alt="Unpetrified Stores"></a>
        <nav>
            <svg class="toggle" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14,6.51561739 C14,8.44860743 15.5670044,10.0156098 17.5,10.0156098 C19.4329966,10.0156098 21,8.4486064 21,6.51560977 C21,4.57131311 19.4364842,3.00779729 17.5077897,3.00779729 C15.5663361,3.01157885 14,4.58097424 14,6.51561739 Z M14.6835733,3.00199839 L6.50096799,3.00780395 C4.56633274,3.01157885 3,4.58097083 3,6.51560977 C3,8.4486064 4.56700338,10.0156098 6.5,10.0156098 L14.6713321,10.0156098 C13.6518334,9.19063303 13,7.92924628 13,6.51561739 C13,5.09538686 13.6568582,3.82832653 14.6835733,3.00199839 Z M17.5937693,2.00877801 C20.0395941,2.05902366 22,4.05057698 22,6.50000762 C22,9.00089115 19.9852814,11.0156098 17.5,11.0156098 L6.5,11.0156098 C4.01471863,11.0156098 2,9.00089115 2,6.51560977 C2,4.02944793 4.01285966,2.0126569 6.49963762,2.00780503 L17.4996452,2.00000013 C17.531818,1.9999773 17.5632832,2.00299364 17.5937693,2.00877801 L17.5937693,2.00877801 Z M6.40623066,13.008778 C6.43671678,13.0029936 6.46818199,12.9999773 6.50035477,13.0000001 L17.5003624,13.007805 C19.9871403,13.0126569 22,15.0294479 22,17.5156098 C22,20.0008911 19.9852814,22.0156098 17.5,22.0156098 L6.5,22.0156098 C4.01471863,22.0156098 2,20.0008911 2,17.5000076 C2,15.050577 3.96040588,13.0590237 6.40623066,13.008778 L6.40623066,13.008778 Z M10,17.5156174 C10,15.5809742 8.43366386,14.0115788 6.49221033,14.0077973 C4.56351582,14.0077973 3,15.5713131 3,17.5156098 C3,19.4486064 4.56700338,21.0156098 6.5,21.0156098 C8.43299559,21.0156098 10,19.4486074 10,17.5156174 Z M9.31642674,14.0019984 C10.3431418,14.8283265 11,16.0953869 11,17.5156174 C11,18.9292463 10.3481666,20.190633 9.32866789,21.0156098 L17.5,21.0156098 C19.4329966,21.0156098 21,19.4486064 21,17.5156098 C21,15.5809708 19.4336673,14.0115789 17.499032,14.007804 L9.31642674,14.0019984 Z"/></svg>
            <ul class="nav">
                {% if user.is_authenticated %}
                    <li><a class="login" href="{% url 'logout' %}?next={{request.path}}"><span>{{request.user.username}}</span><svg style="fill: green;" class="user" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 128c39.77 0 72 32.24 72 72S295.8 272 256 272c-39.76 0-72-32.24-72-72S216.2 128 256 128zM256 448c-52.93 0-100.9-21.53-135.7-56.29C136.5 349.9 176.5 320 224 320h64c47.54 0 87.54 29.88 103.7 71.71C356.9 426.5 308.9 448 256 448z"/></svg></a></li>
                    {% else %} 
                    <li><a class="login" href="{% url 'login' %}?next={{request.path}}"><span>Sign in</span><svg style="fill: rgb(184, 0, 0);" class="user" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 128c39.77 0 72 32.24 72 72S295.8 272 256 272c-39.76 0-72-32.24-72-72S216.2 128 256 128zM256 448c-52.93 0-100.9-21.53-135.7-56.29C136.5 349.9 176.5 320 224 320h64c47.54 0 87.54 29.88 103.7 71.71C356.9 426.5 308.9 448 256 448z"/></svg></a></li>
                {% endif %}
                {% if view_cat %}
                    <li class="categories">Categories
                        <ul>
                            {% for cat in categories %}
                                <li>
                                    {% if cat.no_of_products %}
                                        <a href="{{cat.name}}">{{cat.name}} ({{cat.no_of_products}})</a>
                                    {% else %}
                                        <span>{{cat.name}} ({{cat.no_of_products}})</>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% endif %}
            </ul>
            <a href="{% url 'cart' %}" class="cart-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M96 0C107.5 0 117.4 8.19 119.6 19.51L121.1 32H541.8C562.1 32 578.3 52.25 572.6 72.66L518.6 264.7C514.7 278.5 502.1 288 487.8 288H170.7L179.9 336H488C501.3 336 512 346.7 512 360C512 373.3 501.3 384 488 384H159.1C148.5 384 138.6 375.8 136.4 364.5L76.14 48H24C10.75 48 0 37.25 0 24C0 10.75 10.75 0 24 0H96zM128 464C128 437.5 149.5 416 176 416C202.5 416 224 437.5 224 464C224 490.5 202.5 512 176 512C149.5 512 128 490.5 128 464zM512 464C512 490.5 490.5 512 464 512C437.5 512 416 490.5 416 464C416 437.5 437.5 416 464 416C490.5 416 512 437.5 512 464z"/></svg>
                <span class="cart-quantity">{{cartDetails.getItemTotal}}</span>
            </a>
        </nav>
    </header>
    {%block content %}{% endblock %}
    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script type="text/javascript"> 
        const user = '{{request.user}}',
            csrf_token = getCookie('csrftoken');
        
        let cart = JSON.parse(getCookie('cart'));

        if (cart == null) {
            cart = {};
            setCookie('cart', cart)
        }

        function updateCart(quantity = '.cart-quantity', quantity_total='.items') {
            var total = 0;
            Object.keys(cart).forEach(key => {
                total += cart[key]['quantity'];
            });
            $(quantity).text(total);
            try {
                if (url) {
                    total = "Items: " + total
                }
            } catch (e) {
                console.log(e);
            }
            $(quantity_total).text(total);
}

        function getCookie(name) {
                var cookieValue = null;
                if(document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue
            }

        function setCookie(name, value) {
            document.cookie = name + '=' + JSON.stringify(value) + ';domain=;path=/;SameSite=Strict';
        }

        function removedProduct(cart_val = "") {
            if (cart_val !== "") {
                var new_cart = JSON.parse('{{new_cart}}'.replaceAll("&quot;", "\""));
                setCookie('cart', new_cart);
            }
        }
        
        $('body').on('click', function () {
            if ($('.toggle ').css('display') === 'block') {
                if ($('.nav').css('display') === 'flex') {
                    $('.nav').toggle();
                }
                if ($('.categories ul').css('display') === 'flex') {
                    $('.categories ul').toggle();
                }
            }
        })

        $('.categories').on('click', function (e) {
            e.stopPropagation();
            $('.categories ul').toggle();
        })

        $('.toggle').on('click', function (e) {
            e.stopPropagation();
            $('.nav').toggle();
        });
    </script>
    {%block script %}{% endblock %}
</body>
</html>